# Ahava Healthcare Deployment Guide

## üöÄ Default Provider: Railway
**Railway is configured as the primary deployment target** with Render and Fly.io as alternatives.

### Services
- **API** (`apps/backend`) - Express.js backend with Prisma
- **Admin Web** (`apps/admin`) - Next.js admin portal  
- **Doctor Web** (`apps/doctor`) - Next.js doctor portal
- **Worker** (`apps/worker`) - BullMQ PDF generation queue
- **Postgres** - Managed PostgreSQL database
- **Redis** - Managed Redis for sessions and queues

## üîß Quick Setup (Railway - Default)

### 1. Railway Setup
```bash
# Install Railway CLI
curl -fsSL https://railway.app/install.sh | sh

# Login to Railway
railway login

# Initialize project (one-time setup)
railway init
```

### 2. GitHub Secrets Setup
Add these secrets to your GitHub repository (`@MphoBeeThwala/ahava-healthcare`):

**Required for Railway deployment:**
- `RAILWAY_TOKEN` - Get from https://railway.app/account/tokens

**Optional (for alternatives):**
- `RENDER_API_KEY` - For Render deployment
- `FLY_API_TOKEN` - For Fly.io deployment

### 3. Environment Variables
Copy `deploy/env/*.env.example` files and set these key variables:

**Backend (`apps/backend/.env`):**
```bash
DATABASE_URL=postgresql://...  # Auto-generated by Railway
REDIS_URL=redis://...          # Auto-generated by Railway  
JWT_SECRET=your-32-char-secret
ENCRYPTION_KEY=base64-32-byte-key
PAYSTACK_SECRET_KEY=sk_test_...
```

**Admin/Doctor (`apps/admin/.env`, `apps/doctor/.env`):**
```bash
NEXT_PUBLIC_API_URL=https://your-api.railway.app
```

### 4. Deploy
```bash
# Push to main branch - CI will auto-deploy to Railway
git push origin main

# Or deploy manually
railway up --service api
railway up --service admin  
railway up --service doctor
railway up --service worker
```

## üîÑ Alternative Providers

### Render (Alternative)
1. Import repository in Render dashboard
2. Use `deploy/render/render.yaml` to create services
3. Set `RENDER_API_KEY` secret for CI deployment

### Fly.io (Alternative)  
1. Create apps: `flyctl apps create`
2. Deploy: `flyctl deploy -c deploy/fly/api.fly.toml`
3. Set `FLY_API_TOKEN` secret for CI deployment

## üìã CI/CD Pipeline
GitHub Actions workflow (`.github/workflows/deploy.yml`):
- **Builds** Docker images for API and Worker
- **Pushes** to GitHub Container Registry  
- **Deploys** to Railway (default) when `RAILWAY_TOKEN` is set
- **Falls back** to Render/Fly.io if their tokens are available

## üîê Security Notes
- Timezone: `Africa/Johannesburg` (hardcoded)
- Encryption: AES-256 for sensitive data
- Webhooks: Use ngrok for Paystack in development
- Storage: Railway volumes for PDF exports

## üìä Monitoring
- Railway dashboard: https://railway.app/dashboard
- GitHub Actions: Repository ‚Üí Actions tab
- Logs: `railway logs --service <name>`

